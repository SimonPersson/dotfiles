# Template file for 'webkit2gtk'
pkgname=webkit2gtk
version=2.16.3
revision=1
wrksrc="webkitgtk-$version"
build_style=cmake
configure_args="-DPORT=GTK -DENABLE_GTKDOC=OFF -DCMAKE_LINKER=${XBPS_CROSS_TRIPLET}-gcc \
		-DUSE_LIBSECRET=0 -DENABLE_GEOLOCATION=OFF -DENABLE_INTROSPECTION=OFF \
		-DENABLE_PLUGIN_PROCESS_GTK2=0 -DUSE_LIBNOTIFY=0 -DENABLE_WAYLAND_TARGET=0 \
		-DENABLE_TOUCH_EVENTS=0 -DUSE_LIBHYPHEN=0 -DENABLE_SPELLCHECK=0"
short_desc="GTK+3 port of the WebKit2 browser engine"
maintainer="Enno Boland <gottox@voidlinux.eu>"
homepage="http://webkitgtk.org/"
license="LGPL-2.1, 2-clause-BSD"
distfiles="${homepage}/releases/webkitgtk-${version}.tar.xz"
checksum=204e9131da0101b9bc8765716e70a897121af04b964d9827cd9f20816a77b512

# ETOOHUGE
nodebug=1

hostmakedepends="perl python pkg-config intltool gperf flex ruby glib-devel geoclue2 cmake"
makedepends="
 at-spi2-core-devel libjpeg-turbo-devel libpng-devel sqlite-devel
 harfbuzz-devel libsoup-devel libxslt-devel
 gnutls-devel icu-devel dbus-glib-devel libwebp-devel
 gtk+3-devel libgudev-devel ruby-devel
 libXt-devel gst-plugins-base1-devel"

case "$XBPS_TARGET_MACHINE" in
aarch64*)
	broken="https://build.voidlinux.eu/builders/aarch64_builder/builds/1709/steps/shell_3/logs/stdio" ;;
armv6*)
	configure_args+=" -DENABLE_JIT=0"
	CXXFLAGS="-D__GCC_HAVE_SYNC_COMPARE_AND_SWAP_8=1"
	;;
esac

post_install() {
	vlicense Source/WebCore/LICENSE-APPLE
	vlicense Source/WebCore/LICENSE-LGPL-2.1
	vlicense Source/WebCore/LICENSE-LGPL-2
}

webkit2gtk-devel_package() {
	depends="gtk+3-devel libsoup-devel ${sourcepkg}>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		if [ "$build_option_gir" ]; then
			vmove usr/share/gir-1.0
		fi
		vmove "usr/lib/*.so"
	}
}
